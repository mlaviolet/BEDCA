---
title: "Chapter 4: Describing Relationships Between Variables"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Chapter 4: Describing Relationships Between Variables}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, message=FALSE}
library(BEDCA)
library(mosaic)
library(tidyverse)
library(emmeans)
library(broom)
theme_set(theme_bw())
```

## 4.1: Fitting a Line by Least Squares

## 4.2: Fitting Curves and Surfaces by Least Squares

## 4.3: Fitted Effects for Factorial Data

Change `wood` and `joint` variables to factors.

```{r}
wood_joints <- table4_11 |> 
  mutate(wood = factor(wood, levels = c("pine", "oak", "walnut")),
         joint = factor(joint, levels = c("butt", "beveled", "lap")))
str(wood_joints)
```

Find mean strength of all specimens.

```{r}
options(digits = 5)
wood_joints |> 
  summarize(mean_strength = mean(strength))
```

Find sample means for all nine wood-joint combinations.

```{r}
options(digits = 4)
wood_joints |> 
  summarize(.by = c(joint, wood),
            mean_strength = mean(strength)
            )
```

Find mean of the nine combination means.

```{r}
options(digits = 5)
wood_joints |> 
  summarize(.by = c(joint, wood),
            mean_strength = mean(strength)) |> 
  summarize(cell_mean_strength = mean(mean_strength)
            )
```

Note difference due to unbalanced data.

Fit model with main effects only.

```{r}
wj_mod_main <- lm(strength ~ joint + wood, data = wood_joints,
                  contrasts = list(joint = contr.sum,
                                   wood = contr.sum))
summary(wj_mod_main)

lsmeans(wj_mod_main, spec = ~ joint + wood) 
```

Interaction plot, main effects only.

```{r}
emmip(wj_mod_main, joint ~ wood, col = "black",
      linearg = list(), dotarg = list(size = 2)) +
  scale_y_continuous(breaks = seq(600, 2400, 200)) +
  labs(x = "Wood", y = "Stress at failure (psi)")
```

Fit the full model with interaction.

```{r}
wj_mod <- lm(strength ~ joint * wood, data = wood_joints,
             contrasts = list(joint = contr.sum,
                              wood = contr.sum))
summary(wj_mod)
lsmeans(wj_mod, spec = ~ joint + wood) 
```


## 4.4 Transformations and Choice of Measurement Scale
